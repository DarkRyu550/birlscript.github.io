<!DOCTYPE html>
<html lang="pt_BR">

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
  <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <!-- CodeMirror stuff -->
  <link rel="stylesheet" type="text/css" href="codemirror/lib/codemirror.css">
  <script type="text/javascript" src="codemirror/lib/codemirror.js"></script>
  <script type="text/javascript" src="https://cdn.rawgit.com/codemirror/CodeMirror/master/mode/xml/xml.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="stylesheets/themes/main.css">
  <script src="codemirror/mode/javascript/javascript.js"></script>
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="images/favicon.png" />
  <title>BIRLSCRIPT</title>
</head>

<body>
  <div id="container">
    <div class="inner">

      <header>
        <h1>BIRLSCRIPT</h1>
      </header>

      <section id="downloads" class="clearfix">
        <a href="https://github.com/birlscript/birlscript" id="view-on-github" class="button"><span>GitHub</span></a>
      </section>

      <hr>

      <section id="main_content">
        <h1>
          <a id="birlscript" class="anchor" href="#birlscript" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span>BIRLSCRIPT</a>
        </h1>
        <p><strong>Versão: </strong>1.2.0</p>
        <p>É a linguagem de programação dos codebuilders, que não saem de casa sem codar pra caralho!</p>
        <br>
        <p>Se você se sente apto pro desafio, vá em frente e teste no console abaixo. Veja <a href="#">tutoriais e mais exemplos</a>.</p>
        <br>
        <textarea id="code" style="resize: none; text-align: left"></textarea>
        <center>
          <textarea id="result" style="width: 95%; background-color: #282828; color: white; font-family: sans-serif; font-size: 16px; resize: none" readonly></textarea>
          <br>
          <button id="send">Executa</button>
        </center>
      </section>

      <footer>
        Copyright (r) 2016, 2017 Rafael R Nakano, <a href="mailto:lazpeng@gmail.com">lazpeng@gmail.com</a>.
      </footer>
    </div>
  </div>
</body>

<script>
  document.getElementById("code").textContent = "JAULA SHOW\n\tCE QUER VER ISSO: \"BORA, \" + CUMPADE + \"!\"\nSAINDO DA JAULA";

  /*global CodeMirror */

  var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    lineNumbers: true,
    styleActiveLine: true,
    matchBrackets: true,
    mode: "javascript",
    theme: "base16-dark"
  });

  window.addEventListener('load', function() {
    var webSocket = new WebSocket('wss://lit-wave-58325.herokuapp.com');
    var ultimoCodigo = "";

    webSocket.addEventListener('open', function() {
      console.log('conectado');
      document.getElementById("result").textContent = "Interpretador ONLINE";
    });

    webSocket.addEventListener('message', function(msg) {
      var json = JSON.parse(msg.data);
      document.getElementById('result').innerHTML = json['output'];
    });

    document.getElementById('send').addEventListener('click', function() {
      var code = editor.getValue();
      if (code != ultimoCodigo) {
        var json = {
          codigo: code
        };
        webSocket.send(JSON.stringify(json));
        ultimoCodigo = code;
      }
    });
  })
</script>

</html>
